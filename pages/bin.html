<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recycle Bin - Vesso</title>
    <link rel="stylesheet" href="/css/global.css">
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
</head>

<body>
    <h1 class="page-title">Recycle Bin</h1>

    <div id="deleted_task_area"></div>

    <!-- Added backdrop for delete confirmation modal -->
    <div id="delete_backdrop" class="modal-backdrop"></div>

    <div id="delete_popup" class="modal">
        <h3>Are you sure you want to delete this task?</h3>
        <div class="modal-actions">
            <button class="button" id="delete_back_btn">Back</button>
            <button class="button button-danger" id="sure_Delete">Delete</button>
        </div>
    </div>

    <script src="/js/dltTask.js"></script>
    <script src="/js/moveToBin.js"></script>
    <script src="/js/getAllTaskForBin.js"></script>
    <script src="/js/dltTask.js"></script>

    <!-- Add expandable functionality to bin task cards -->
    <script>
        document.addEventListener('click', function(e) {
            const taskCard = e.target.closest('.task-card');
            if (taskCard) {
                if (e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT') {
                    return;
                }
                taskCard.classList.toggle('expanded');
            }
        });

        const deleteBackdrop = document.getElementById('delete_backdrop');
        const deleteModal = document.getElementById('delete_popup');
        const deleteBackBtn = document.getElementById('delete_back_btn');

        // Show backdrop when modal is shown (observe modal changes)
        const modalObserver = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                    if (deleteModal.style.display === 'block' || deleteModal.classList.contains('active')) {
                        deleteBackdrop.classList.add('active');
                    } else {
                        deleteBackdrop.classList.remove('active');
                    }
                }
                if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                    if (deleteModal.classList.contains('active')) {
                        deleteBackdrop.classList.add('active');
                    }
                }
            });
        });

        if (deleteModal) {
            modalObserver.observe(deleteModal, { attributes: true, attributeFilter: ['style', 'class'] });
        }

        // Close modal when clicking backdrop
        if (deleteBackdrop) {
            deleteBackdrop.addEventListener('click', () => {
                deleteModal.style.display = 'none';
                deleteModal.classList.remove('active');
                deleteBackdrop.classList.remove('active');
            });
        }

        // Close modal when clicking back button
        if (deleteBackBtn) {
            deleteBackBtn.addEventListener('click', (e) => {
                e.preventDefault();
                deleteModal.style.display = 'none';
                deleteModal.classList.remove('active');
                deleteBackdrop.classList.remove('active');
            });
        }
    </script>

</body>

</html>
